// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(f,p){function y(){e.dbVersion=1,e.dbName="kv-keeper-items",e.storeName="items",e.defaultType=i,e.namespace=d()}function d(){return e.dbName+":"+e.storeName+":"}function h(e){if(-1==[s,c,i].indexOf(e))throw new Error(t+"Invalid type "+e)}function w(e){switch(e){case i:return I();case c:return u(c,r.create());case s:return u(s,n.create())}return null}function u(e,n){return{type:e,instance:n}}function I(){var e=o.db;return e?u(c,e):(e=r.create())?u(c,e):(e=o.ls,e?u(s,e):u(c,n.create()))}function K(u,o){var n=u.open(e.dbName,e.dbVersion);n.onsuccess=function(n){var e=n.target.result;e.onversionchange=function(){e.close()},o(null,e)},n.onerror=function(n){var e=new Error(t+"DB request error");e.event=n,o(e)},n.onupgradeneeded=function(e){r.setupSchema(e.target.result)},n.onblocked=function(n){var e=new Error(t+"DB is blocked");e.event=n,o(e)}}function a(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(r){var e=new Error(t+"DB request error");e.event=r,n(e)}}function l(e){return function(n,t){n?e(n):e(null,t.target.result)}}var e,N=["setItem","getItem","removeItem","getKeys","getLength","clear"],b=["dbName","storeName","defaultType"],c="db",s="ls",i="auto",m="readwrite",v="readonly",t="[kv-keeper] ",g=Object.keys,o={};p?e=p:f.KvKeeper=e={},y(),e.configure=function(n){if(e.__configured)throw new Error(t+"Configuration can be set only once");e.__configured=!0,"defaultType"in n&&h(n.defaultType),g(n).forEach(function(r){if(!(b.indexOf(r)>-1))throw y(),new Error(t+r+" is not configurable");e[r]=n[r]}),e.namespace=d()},e.getStorage=function(n,r){"function"==typeof n&&(r=n,n=null),n=n||e.defaultType,h(n);var o=e._getInstance(n);if(o)o.init(r);else{var u=n==i?"No supported stores":'No "'+n+'" store support';r(new Error(t+u))}},e._getInstance=function(n){var e=o[n];if(!e){var t=w(n);e=o[t.type]=t.instance}return e},N.forEach(function(n){e[n]=function(){var t=arguments;e.getStorage(function(e,r){if(e){var o=t[t.length-1];return o(e)}r[n].apply(r,t)})}});var n=e.StorageLS=function(t){var e=this;e.init=function(n){n(null,e)},e.setItem=function(r,o,e){try{t.setItem(n.createKey(r),o),e(null)}catch(n){e(n)}},e.getItem=function(e,r){r(null,t.getItem(n.createKey(e)))},e.removeItem=function(e,r){t.removeItem(n.createKey(e)),r(null)},e.getKeys=function(e){var r=g(t).filter(n.isKeeperKey);e(null,r)},e.getLength=function(e){e(null,t.length)},e.clear=function(e){g(t).filter(n.isKeeperKey).forEach(t.removeItem,t),e(null)},e.close=function(){o.ls=null}};n.createKey=function(n){return e.namespace+n},n.isKeeperKey=function(n){return 0==n.indexOf(e.namespace)},n.create=function(){var e=f.localStorage;return e?new n(e):null};var r=e.StorageDB=function(u){function t(n){return r.transaction([e.storeName],n).objectStore(e.storeName)}var r,n=this;n.init=function(e){K(u,function(t,o){return t?e(t):(r=o,void e(null,n))})},n.close=function(){r.close(),o.db=null},n.setItem=function(e,n,r){a(t(m).put({key:e,value:String(n)}),l(r))},n.getItem=function(n,e){a(t(v).get(n),function(n,r){if(n)return e(n);var t=r.target.result;e(null,t?t.value:null)})},n.removeItem=function(e,n){a(t(m).delete(e),l(function(e,t){setTimeout(n.bind(null,e,t),0)}))},n.getKeys=function(e){var n=[];a(t(v).openCursor(),function(r,o){if(r)return e(r);var t=o.target.result;return t?(n.push(t.key),t.continue()):void e(null,n)})},n.getLength=function(e){a(t(v).count(),l(e))},n.clear=function(e){a(t(m).clear(),l(e))}};r.create=function(){var e=f.navigator.userAgent;if(e&&/Safari/.test(e)&&!/Chrome/.test(e))return null;var n=f.indexedDB;return n&&"function"==typeof n.open?new r(n):null},r.setupSchema=function(n){try{n.createObjectStore(e.storeName,{keyPath:"key"})}catch(e){if("ConstraintError"!=e.name)throw e;console.warn(t+"data store already exists")}}}(self,"undefined"!=typeof exports&&exports);
//# sourceMappingURL=kv-keeper.map