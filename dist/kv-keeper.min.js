// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(e){"use strict";function n(){}function t(){k.dbVersion=1,k.dbName="kv-keeper-items",k.storeName="items",k.defaultType=p,k.namespace=r()}function r(){return k.dbName+":"+k.storeName+":"}function o(e){if([g,m,p].indexOf(e)==-1)throw new Error(I+"Invalid type "+e)}function u(e){var t=e||n;return function(e,n){if(e)for(var r=0;r<E.length;r++)E[r](e);return t(e,n)}}function i(e){switch(e){case p:return a();case m:return c(m,L.create());case g:return c(g,K.create())}return null}function c(e,n){return{type:e,instance:n}}function a(){var e=w.db;return e?c(m,e):(e="undefined"!=typeof L&&L.create())?c(m,e):(e=w.ls,e?c(g,e):"undefined"!=typeof K?c(g,K.create()):void 0)}function f(e,n){var t=u(n),r=e.open(k.dbName,k.dbVersion);r.onsuccess=function(){var e=r.result;e.onversionchange=function(){e.close()},t(null,e)},r.onerror=function(e){var n=new Error(I+"DB open request error");n.event=e,t(n)},r.onupgradeneeded=function(){L.setupSchema(r.result)},r.onblocked=function(e){var n=new Error(I+"DB is blocked");n.event=e,t(n)}}function l(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(t){var r=e.error.message||"Unknown error ",o=new Error(I+"DB request error: "+r);o.event=t,n(o)}}function s(e){return function(n,t){n?e(n):e(null,t.target.result)}}var v=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"],d=["dbName","storeName","defaultType"],m="db",g="ls",p="auto",y="readwrite",h="readonly",I="[kv-keeper] ",b=Object.keys,w={},E=[],k={},N=!0;"object"==typeof exports&&(exports=k,N=!1),e.modules&&modules.define&&modules.require&&(modules.define("kv-keeper",function(e){e(k)}),N=!1),N&&(e.KvKeeper=k),t(),k.preconnect=function(){k.getStorage(n)},k.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");E.push(e)},k.removeErrorListener=function(e){var n=E.indexOf(e);n>-1&&E.splice(n,1)},k.getErrorListeners=function(){return E},k.removeAllErrorListeners=function(){E=[]},k.configure=function(e){if(k.__configured)throw new Error(I+"Configuration can be set only once");k.__configured=!0,"defaultType"in e&&o(e.defaultType);for(var n in e)if(e.hasOwnProperty(n)){if(!(d.indexOf(n)>-1))throw t(),new Error(I+n+" is not configurable");k[n]=e[n]}k.namespace=r()},k.getStorage=function(e,n){var t=e,r=n;"function"==typeof t&&(r=e,t=null),r=u(r),t=t||k.defaultType,o(t),k._getInstance(t,r)},k._getInstance=function(e,n){var t=w[e];if(t)return n(null,t);var r=I+(e==p?"No supported storages":'No "'+e+'" storage support');if(null===t)return n(new Error(r));var o=i(e);return o&&o.instance?(t=w[e]=o.instance,void t.init(n)):n(new Error(r))},v.forEach(function(e){k[e]=function(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);k.getStorage(function(r,o){if(r){var u=t.filter(function(e){return"function"==typeof e})[0]||n;return u(r)}o[e].apply(o,t)})}});var K=k.StorageLS=function(e){var t=this;t.init=function(e){e(null,t)},t.setItem=function(n,t,r){var o=u(r);try{e.setItem(K.createKey(n),t),o(null)}catch(e){o(e)}},t.getItem=function(n,t){t(null,e.getItem(K.createKey(n)))},t.hasItem=function(n,t){t(null,null!==e.getItem(K.createKey(n)))},t.removeItem=function(t,r){var o=r||n;e.removeItem(K.createKey(t)),o(null)},t.getKeys=function(n){for(var t=b(e),r=k.namespace.length,o=[],u=0;u<t.length;u++){var i=t[u];S(i)&&o.push(i.slice(r))}n(null,o)},t.getLength=function(n){n(null,b(e).filter(S).length)},t.clear=function(n){b(e).filter(S).forEach(e.removeItem,e),n(null)},t.close=function(){delete w.ls,delete w.auto}};K.createKey=function(e){return k.namespace+e};var S=K.isKeeperKey=function(e){return 0==e.indexOf(k.namespace)};K.create=function(){var n;try{n=e.localStorage}catch(e){}return n?new K(n):null};var L=k.StorageDB=function(e){function n(e){return t.transaction([k.storeName],e).objectStore(k.storeName)}var t,r=this;r.init=function(n){var o=u(n);f(e,function(e,n){return e?o(e):(t=n,void o(null,r))})},r.close=function(){t&&t.close(),delete w.db,delete w.auto},r.setItem=function(e,t,r){var o=u(r);l(n(y).put({key:e,value:String(t)}),s(o))},r.getItem=function(e,t){var r=u(t);l(n(h).get(e),function(e,n){if(e)return r(e);var t=n.target.result;r(null,t?t.value:null)})},r.hasItem=function(e,t){var r=u(t);l(n(h).get(e),function(e,n){return e?r(e):void r(null,Boolean(n.target.result))})},r.removeItem=function(e,t){var r=u(t);l(n(y).delete(e),s(function(e,n){setTimeout(r.bind(null,e,n),0)}))},r.getKeys=function(e){var t=u(e),r=[];l(n(h).openCursor(),function(e,n){if(e)return t(e);var o=n.target.result;return o?(r.push(o.key),o.continue()):void t(null,r)})},r.getLength=function(e){var t=u(e);l(n(h).count(),s(t))},r.clear=function(e){var t=u(e);l(n(y).clear(),s(t))}};L.create=function(){var n=e.indexedDB;return n&&n.open&&e.IDBKeyRange?new L(n):null},L.setupSchema=function(e){e.objectStoreNames.contains(k.storeName)||e.createObjectStore(k.storeName,{keyPath:"key"})}}(self);
//# sourceMappingURL=kv-keeper.map