// Key-Value Keeper by andre487, see https://clck.ru/9cB92
(function(e,t){"use strict";var n={};var r={};if(typeof e!=="undefined"){r=e}r.DB_NAME="kv-keeper-items";r.DB_VERSION=1;r.STORE_NAME="items";r.getStorage=function(e,t){if(typeof e==="function"){t=e;e=null}e=e||"auto";var n=r._getInstance(e);if(n){n.ensureReady(t)}else{var u=e==="auto"?"This platform does not support any storages":'Storage with type "'+e+'" is not supported';t(new Error("[kv-keeper] "+u))}};r._getInstance=function(e){if(!n[e]){var t=u(e);if(t){n[e]=t.create()}}return n[e]};function u(e){switch(e){case"auto":return i;case"db":return c;case"ls":return a}}r._clearInstance=function(e){n[e]=null};var o=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"];o.forEach(function(e){r[e]=function(){var t=[];[].push.apply(t,arguments);r.getStorage(function(n,r){if(n){var u=t[t.length-1];return u(n)}r[e].apply(r,t)})}});var i={create:function(){return c.create()||a.create()}};var a=r.StorageLS=function(e){var t=this;this.ensureReady=function(e){e(null,t)};this.setItem=function(t,n,r){try{e.setItem(t,n);r&&r(null)}catch(e){r&&r(e)}};this.getItem=function(t,n){n(null,e.getItem(t))};this.hasItem=function(t,n){n(null,t in e)};this.removeItem=function(t,n){e.removeItem(t);n&&n(null)};this.getKeys=function(t){t(null,Object.keys(e))};this.getLength=function(t){t(null,e.length)};this.clear=function(t){e.clear();t&&t(null)};this.close=function(){}};a.create=function(){var e=window.localStorage;return e?new a(e):null};var c=r.StorageDB=function(e){var t=this;this.ensureReady=function(n){s(e,function(e,r){if(e){return n(e)}t._db=r;n(null,t)})};this.close=function(){t._db.close()};this.setItem=function(e,t,r){var u=n("readwrite").put({key:e,value:t});l(u,f(r))};this.getItem=function(e,t){var r=n("readonly").get(e);l(r,f(t,"target.result.value"))};this.hasItem=function(e,t){var r=n("readonly").openCursor(e);l(r,function(e,n){if(e){return t(e)}t(null,Boolean(n.target.result))})};this.removeItem=function(e,t){var r=n("readwrite").delete(e);l(r,f(t))};this.getKeys=function(e){var t=n("readonly").openCursor();var r=[];l(t,function(t,n){if(t){return e(t)}var u=n.target.result;if(u){r.push(u.key);return u.continue()}e(null,r)})};this.getLength=function(e){var t=n("readonly").count();l(t,f(e,"target.result"))};this.clear=function(e){var t=n("readwrite").clear();l(t,f(e))};function n(e){return t._db.transaction([r.STORE_NAME],e).objectStore(r.STORE_NAME)}};c.create=function(){var e=window.indexedDB;return e?new c(e):null};c.setupSchema=function(e){e.createObjectStore(r.STORE_NAME,{keyPath:"key"})};function s(e,t){var n=e.open(r.DB_NAME,r.DB_VERSION);l(n,f(t,"target.result"));n.onupgradeneeded=function(e){c.setupSchema(e.target.result)};n.onblocked=function(e){var n=new Error("[kv-keeper] DB is blocked");n.event=e;t(n)}}function l(e,t){e.onsuccess=function(e){t(null,e)};e.onerror=function(e){var n=new Error("[kv-keeper] DB request error");n.event=e;t(n)}}function f(e,t){if(!e){return function(){}}return function(n,r){if(n){return e(n)}if(typeof t==="undefined"){return e(null)}var u=t.split(".");var o=r;for(var i=0;i<u.length;i++){if(!(u[i]in o)){o=null;break}o=o[u[i]]}e(null,o)}}t["KvKeeper"]=e})({},function(){return this}());
//# sourceMappingURL=kv-keeper.map