// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(e,n){"use strict";function t(){d.dbVersion=1,d.dbName="kv-keeper-items",d.storeName="items",d.defaultType=y,d.namespace=r()}function r(){return d.dbName+":"+d.storeName+":"}function o(e){if([m,g,y].indexOf(e)==-1)throw new Error(w+"Invalid type "+e)}function u(e){return function(n,t){if(n)for(var r=0;r<k.length;r++)k[r](n);return e(n,t)}}function i(e){switch(e){case y:return a();case g:return c(g,I.create());case m:return c(m,LS.create())}return null}function c(e,n){return{type:e,instance:n}}function a(){var e=N.db;return e?c(g,e):(e="undefined"!=typeof I&&I.create())?c(g,e):(e=N.ls,e?c(m,e):"undefined"!=typeof LS?c(g,LS.create()):void 0)}function f(e,n){n=u(n);var t=e.open(d.dbName,d.dbVersion);t.onsuccess=function(){var e=t.result;e.onversionchange=function(){e.close()},n(null,e)},t.onerror=function(e){var t=new Error(w+"DB open request error");t.event=e,n(t)},t.onupgradeneeded=function(){I.setupSchema(t.result)},t.onblocked=function(e){var t=new Error(w+"DB is blocked");t.event=e,n(t)}}function s(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(t){var r=e.error.message||"Unknown error ",o=new Error(w+"DB request error: "+r);o.event=t,n(o)}}function l(e){return function(n,t){n?e(n):e(null,t.target.result)}}var d,v=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"],p=["dbName","storeName","defaultType"],g="db",m="ls",y="auto",h="readwrite",b="readonly",w="[kv-keeper] ",E=Object.keys,N={},k=[];n?d=n:e.KvKeeper=d={},t(),d.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");k.push(e)},d.removeErrorListener=function(e){var n=k.indexOf(e);n>-1&&k.splice(n,1)},d.getErrorListeners=function(){return k},d.removeAllErrorListeners=function(){k=[]},d.configure=function(e){if(d.__configured)throw new Error(w+"Configuration can be set only once");d.__configured=!0,"defaultType"in e&&o(e.defaultType),E(e).forEach(function(n){if(!(p.indexOf(n)>-1))throw t(),new Error(w+n+" is not configurable");d[n]=e[n]}),d.namespace=r()},d.getStorage=function(e,n){"function"==typeof e&&(n=e,e=null),n=u(n),e=e||d.defaultType,o(e);var t=d._getInstance(e);if(t)t.init(n);else{var r=e==y?"No supported stores":'No "'+e+'" store support';n(new Error(w+r))}},d._getInstance=function(e){var n=N[e];if(!n){var t=i(e);n=N[t.type]=t.instance}return n},v.forEach(function(e){d[e]=function(){var n=arguments;d.getStorage(function(t,r){if(t){var o=n[n.length-1];return o(t)}r[e].apply(r,n)})}});var I=d.StorageDB=function(e){function n(e){return t.transaction([d.storeName],e).objectStore(d.storeName)}var t,r=this;r.init=function(n){n=u(n),f(e,function(e,o){return e?n(e):(t=o,void n(null,r))})},r.close=function(){t.close(),N.db=null},r.setItem=function(e,t,r){r=u(r),s(n(h).put({key:e,value:String(t)}),l(r))},r.getItem=function(e,t){t=u(t),s(n(b).get(e),function(e,n){if(e)return t(e);var r=n.target.result;t(null,r?r.value:null)})},r.hasItem=function(e,t){t=u(t),s(n(b).get(e),function(e,n){return e?t(e):void t(null,Boolean(n.target.result))})},r.removeItem=function(e,t){t=u(t),s(n(h).delete(e),l(function(e,n){setTimeout(t.bind(null,e,n),0)}))},r.getKeys=function(e){e=u(e);var t=[];s(n(b).openCursor(),function(n,r){if(n)return e(n);var o=r.target.result;return o?(t.push(o.key),o.continue()):void e(null,t)})},r.getLength=function(e){e=u(e),s(n(b).count(),l(e))},r.clear=function(e){e=u(e),s(n(h).clear(),l(e))}};I.create=function(){var n=e.indexedDB;return n&&n.open&&e.IDBKeyRange?new I(n):null},I.setupSchema=function(e){e.objectStoreNames.contains(d.storeName)||e.createObjectStore(d.storeName,{keyPath:"key"})}}(self,"undefined"!=typeof exports&&exports);
//# sourceMappingURL=kv-keeper.db.map