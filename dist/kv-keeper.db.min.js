// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(s,g){"use strict";function m(){e.dbVersion=1,e.dbName="kv-keeper-items",e.storeName="items",e.defaultType=f,e.namespace=v()}function v(){return e.dbName+":"+e.storeName+":"}function p(e){if(-1==[a,u,f].indexOf(e))throw new Error(t+"Invalid type "+e)}function N(e){switch(e){case f:return h();case u:return r(u,n.create());case a:return r(a,LS.create())}return null}function r(e,n){return{type:e,instance:n}}function h(){var e=c.db;return e?r(u,e):(e="undefined"!=typeof n&&n.create())?r(u,e):(e=c.ls,e?r(a,e):"undefined"!=typeof LS?r(u,LS.create()):void 0)}function b(u,o){var r=u.open(e.dbName,e.dbVersion);r.onsuccess=function(){var e=r.result;e.onversionchange=function(){e.close()},o(null,e)},r.onerror=function(n){var e=new Error(t+"DB open request error");e.event=n,o(e)},r.onupgradeneeded=function(){n.setupSchema(r.result)},r.onblocked=function(n){var e=new Error(t+"DB is blocked");e.event=n,o(e)}}function o(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(o){var u=e.error.message||"Unknown error ",r=new Error(t+"DB request error: "+u);r.event=o,n(r)}}function i(e){return function(n,t){n?e(n):e(null,t.target.result)}}var e,y=["setItem","getItem","removeItem","getKeys","getLength","clear"],k=["dbName","storeName","defaultType"],u="db",a="ls",f="auto",d="readwrite",l="readonly",t="[kv-keeper] ",w=Object.keys,c={};g?e=g:s.KvKeeper=e={},m(),e.configure=function(n){if(e.__configured)throw new Error(t+"Configuration can be set only once");e.__configured=!0,"defaultType"in n&&p(n.defaultType),w(n).forEach(function(r){if(!(k.indexOf(r)>-1))throw m(),new Error(t+r+" is not configurable");e[r]=n[r]}),e.namespace=v()},e.getStorage=function(n,r){"function"==typeof n&&(r=n,n=null),n=n||e.defaultType,p(n);var o=e._getInstance(n);if(o)o.init(r);else{var u=n==f?"No supported stores":'No "'+n+'" store support';r(new Error(t+u))}},e._getInstance=function(n){var e=c[n];if(!e){var t=N(n);e=c[t.type]=t.instance}return e},y.forEach(function(n){e[n]=function(){var t=arguments;e.getStorage(function(e,r){if(e){var o=t[t.length-1];return o(e)}r[n].apply(r,t)})}});var n=e.StorageDB=function(u){function t(n){return r.transaction([e.storeName],n).objectStore(e.storeName)}var r,n=this;n.init=function(e){b(u,function(t,o){return t?e(t):(r=o,void e(null,n))})},n.close=function(){r.close(),c.db=null},n.setItem=function(e,n,r){o(t(d).put({key:e,value:String(n)}),i(r))},n.getItem=function(n,e){o(t(l).get(n),function(n,r){if(n)return e(n);var t=r.target.result;e(null,t?t.value:null)})},n.removeItem=function(e,n){o(t(d).delete(e),i(function(e,t){setTimeout(n.bind(null,e,t),0)}))},n.getKeys=function(e){var n=[];o(t(l).openCursor(),function(r,o){if(r)return e(r);var t=o.target.result;return t?(n.push(t.key),t.continue()):void e(null,n)})},n.getLength=function(e){o(t(l).count(),i(e))},n.clear=function(e){o(t(d).clear(),i(e))}};n.create=function(){var e=s.indexedDB;return e&&e.open&&s.IDBKeyRange?new n(e):null},n.setupSchema=function(n){n.objectStoreNames.contains(e.storeName)||n.createObjectStore(e.storeName,{keyPath:"key"})}}(self,"undefined"!=typeof exports&&exports);
//# sourceMappingURL=kv-keeper.db.map