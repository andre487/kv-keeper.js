// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(v,g){"use strict";function y(){e.dbVersion=1,e.dbName="kv-keeper-items",e.storeName="items",e.defaultType=s,e.namespace=m()}function m(){return e.dbName+":"+e.storeName+":"}function b(e){if(-1==[l,u,s].indexOf(e))throw new Error(r+"Invalid type "+e)}function n(e){return function(n,o){if(n)for(var r=0;r<t.length;r++)t[r](n);return e(n,o)}}function h(e){switch(e){case s:return S();case u:return i(u,o.create());case l:return i(l,LS.create())}return null}function i(e,n){return{type:e,instance:n}}function S(){var e=a.db;return e?i(u,e):(e="undefined"!=typeof o&&o.create())?i(u,e):(e=a.ls,e?i(l,e):"undefined"!=typeof LS?i(u,LS.create()):void 0)}function N(i,u){u=n(u);var t=i.open(e.dbName,e.dbVersion);t.onsuccess=function(){var e=t.result;e.onversionchange=function(){e.close()},u(null,e)},t.onerror=function(n){var e=new Error(r+"DB open request error");e.event=n,u(e)},t.onupgradeneeded=function(){o.setupSchema(t.result)},t.onblocked=function(n){var e=new Error(r+"DB is blocked");e.event=n,u(e)}}function c(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(o){var u=e.error.message||"Unknown error ",t=new Error(r+"DB request error: "+u);t.event=o,n(t)}}function f(e){return function(n,t){n?e(n):e(null,t.target.result)}}var e,E=["setItem","getItem","removeItem","getKeys","getLength","clear"],w=["dbName","storeName","defaultType"],u="db",l="ls",s="auto",d="readwrite",p="readonly",r="[kv-keeper] ",k=Object.keys,a={},t=[];g?e=g:v.KvKeeper=e={},y(),e.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");t.push(e)},e.removeErrorListener=function(n){var e=t.indexOf(n);e>-1&&t.splice(e,1)},e.getErrorListeners=function(){return t},e.removeAllErrorListeners=function(){t=[]},e.configure=function(n){if(e.__configured)throw new Error(r+"Configuration can be set only once");e.__configured=!0,"defaultType"in n&&b(n.defaultType),k(n).forEach(function(t){if(!(w.indexOf(t)>-1))throw y(),new Error(r+t+" is not configurable");e[t]=n[t]}),e.namespace=m()},e.getStorage=function(t,o){"function"==typeof t&&(o=t,t=null),o=n(o),t=t||e.defaultType,b(t);var u=e._getInstance(t);if(u)u.init(o);else{var i=t==s?"No supported stores":'No "'+t+'" store support';o(new Error(r+i))}},e._getInstance=function(n){var e=a[n];if(!e){var t=h(n);e=a[t.type]=t.instance}return e},E.forEach(function(n){e[n]=function(){var t=arguments;e.getStorage(function(e,r){if(e){var o=t[t.length-1];return o(e)}r[n].apply(r,t)})}});var o=e.StorageDB=function(u){function r(n){return o.transaction([e.storeName],n).objectStore(e.storeName)}var o,t=this;t.init=function(e){e=n(e),N(u,function(n,r){return n?e(n):(o=r,void e(null,t))})},t.close=function(){o.close(),a.db=null},t.setItem=function(t,o,e){e=n(e),c(r(d).put({key:t,value:String(o)}),f(e))},t.getItem=function(t,e){e=n(e),c(r(p).get(t),function(n,r){if(n)return e(n);var t=r.target.result;e(null,t?t.value:null)})},t.removeItem=function(t,e){e=n(e),c(r(d).delete(t),f(function(n,t){setTimeout(e.bind(null,n,t),0)}))},t.getKeys=function(e){e=n(e);var t=[];c(r(p).openCursor(),function(r,o){if(r)return e(r);var n=o.target.result;return n?(t.push(n.key),n.continue()):void e(null,t)})},t.getLength=function(e){e=n(e),c(r(p).count(),f(e))},t.clear=function(e){e=n(e),c(r(d).clear(),f(e))}};o.create=function(){var e=v.indexedDB;return e&&e.open&&v.IDBKeyRange?new o(e):null},o.setupSchema=function(n){n.objectStoreNames.contains(e.storeName)||n.createObjectStore(e.storeName,{keyPath:"key"})}}(self,"undefined"!=typeof exports&&exports);
//# sourceMappingURL=kv-keeper.db.map