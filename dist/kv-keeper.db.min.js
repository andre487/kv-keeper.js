// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(e,n){"use strict";function r(){}function t(){d.dbVersion=1,d.dbName="kv-keeper-items",d.storeName="items",d.defaultType=h,d.namespace=o()}function o(){return d.dbName+":"+d.storeName+":"}function u(e){if([y,m,h].indexOf(e)==-1)throw new Error(E+"Invalid type "+e)}function i(e){var n=e||r;return function(e,r){if(e)for(var t=0;t<S.length;t++)S[t](e);return n(e,r)}}function a(e){switch(e){case h:return f();case m:return c(m,k.create());case y:return c(y,LS.create())}return null}function c(e,n){return{type:e,instance:n}}function f(){var e=N.db;return e?c(m,e):(e="undefined"!=typeof k&&k.create())?c(m,e):(e=N.ls,e?c(y,e):"undefined"!=typeof LS?c(y,LS.create()):void 0)}function s(e,n){var r=i(n),t=e.open(d.dbName,d.dbVersion);t.onsuccess=function(){var e=t.result;e.onversionchange=function(){e.close()},r(null,e)},t.onerror=function(e){var n=new Error(E+"DB open request error");n.event=e,r(n)},t.onupgradeneeded=function(){k.setupSchema(t.result)},t.onblocked=function(e){var n=new Error(E+"DB is blocked");n.event=e,r(n)}}function l(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(r){var t=e.error.message||"Unknown error ",o=new Error(E+"DB request error: "+t);o.event=r,n(o)}}function v(e){return function(n,r){n?e(n):e(null,r.target.result)}}var d,g=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"],p=["dbName","storeName","defaultType"],m="db",y="ls",h="auto",b="readwrite",w="readonly",E="[kv-keeper] ",N=(Object.keys,{}),S=[];n?d=n:e.KvKeeper=d={},t(),d.preconnect=function(){d.getStorage(r)},d.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");S.push(e)},d.removeErrorListener=function(e){var n=S.indexOf(e);n>-1&&S.splice(n,1)},d.getErrorListeners=function(){return S},d.removeAllErrorListeners=function(){S=[]},d.configure=function(e){if(d.__configured)throw new Error(E+"Configuration can be set only once");d.__configured=!0,"defaultType"in e&&u(e.defaultType);for(var n in e)if(e.hasOwnProperty(n)){if(!(p.indexOf(n)>-1))throw t(),new Error(E+n+" is not configurable");d[n]=e[n]}d.namespace=o()},d.getStorage=function(e,n){var r=e,t=n;"function"==typeof r&&(t=e,r=null),t=i(t),r=r||d.defaultType,u(r),d._getInstance(r,t)},d._getInstance=function(e,n){var r=N[e];if(r)return n(null,r);var t=E+(e==h?"No supported storages":'No "'+e+'" storage support');if(null===r)return n(new Error(t));var o=a(e);return o&&o.instance?(r=N[e]=o.instance,void r.init(n)):n(new Error(t))},g.forEach(function(e){d[e]=function(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);d.getStorage(function(r,t){if(r){var o=n[n.length-1];return o(r)}t[e].apply(t,n)})}});var k=d.StorageDB=function(e){function n(e){return r.transaction([d.storeName],e).objectStore(d.storeName)}var r,t=this;t.init=function(n){var o=i(n);s(e,function(e,n){return e?o(e):(r=n,void o(null,t))})},t.close=function(){r&&r.close(),delete N.db,delete N.auto},t.setItem=function(e,r,t){var o=i(t);l(n(b).put({key:e,value:String(r)}),v(o))},t.getItem=function(e,r){var t=i(r);l(n(w).get(e),function(e,n){if(e)return t(e);var r=n.target.result;t(null,r?r.value:null)})},t.hasItem=function(e,r){var t=i(r);l(n(w).get(e),function(e,n){return e?t(e):void t(null,Boolean(n.target.result))})},t.removeItem=function(e,r){var t=i(r);l(n(b).delete(e),v(function(e,n){setTimeout(t.bind(null,e,n),0)}))},t.getKeys=function(e){var r=i(e),t=[];l(n(w).openCursor(),function(e,n){if(e)return r(e);var o=n.target.result;return o?(t.push(o.key),o.continue()):void r(null,t)})},t.getLength=function(e){var r=i(e);l(n(w).count(),v(r))},t.clear=function(e){var r=i(e);l(n(b).clear(),v(r))}};k.create=function(){var n=e.indexedDB;return n&&n.open&&e.IDBKeyRange?new k(n):null},k.setupSchema=function(e){e.objectStoreNames.contains(d.storeName)||e.createObjectStore(d.storeName,{keyPath:"key"})}}(self,"undefined"!=typeof exports&&exports);
//# sourceMappingURL=kv-keeper.db.map