!function(e){"use strict";function n(){}function r(){y.dbVersion=1,y.dbName="kv-keeper-items",y.storeName="items",y.defaultType="auto",y.namespace=t()}function t(){return y.dbName+":"+y.storeName+":"}function o(e){if(["ls","db","auto"].indexOf(e)==-1)throw new Error(p+"Invalid type "+e)}function u(e){var r=e||n;return function(e,n){if(e)for(var t=0;t<m.length;t++)m[t](e);return r(e,n)}}function i(e){switch(e){case"auto":return c();case"db":return a("db",h.create());case"ls":return a("ls",LS.create())}return null}function a(e,n){return{type:e,instance:n}}function c(){var e=g.db;return e?a("db",e):(e=void 0!==h&&h.create())?a("db",e):(e=g.ls,e?a("ls",e):"undefined"!=typeof LS?a("ls",LS.create()):void 0)}function f(e,n){var r=u(n),t=e.open(y.dbName,y.dbVersion);t.onsuccess=function(){var e=t.result;e.onversionchange=function(){e.close()},r(null,e)},t.onerror=function(e){var n=new Error(p+"DB open request error");n.event=e,r(n)},t.onupgradeneeded=function(){h.setupSchema(t.result)},t.onblocked=function(e){var n=new Error(p+"DB is blocked");n.event=e,r(n)}}function s(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(r){var t=e.error.message||"Unknown error ",o=new Error(p+"DB request error: "+t);o.event=r,n(o)}}function l(e){return function(n,r){n?e(n):e(null,r.target.result)}}var d=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"],v=["dbName","storeName","defaultType"],p="[kv-keeper] ",g=(Object.keys,{}),m=[],y={},b=!0;"object"==typeof exports&&(exports=y,b=!1),e.modules&&modules.define&&modules.require&&(modules.define("kv-keeper",function(e){e(y)}),b=!1),b&&(e.KvKeeper=y),r(),y.preconnect=function(){y.getStorage(n)},y.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");m.push(e)},y.removeErrorListener=function(e){var n=m.indexOf(e);n>-1&&m.splice(n,1)},y.getErrorListeners=function(){return m},y.removeAllErrorListeners=function(){m=[]},y.configure=function(e){if(y.__configured)throw new Error(p+"Configuration can be set only once");y.__configured=!0,"defaultType"in e&&o(e.defaultType);for(var n in e)if(e.hasOwnProperty(n)){if(!(v.indexOf(n)>-1))throw r(),new Error(p+n+" is not configurable");y[n]=e[n]}y.namespace=t()},y.getStorage=function(e,n){var r=e,t=n;"function"==typeof r&&(t=e,r=null),t=u(t),r=r||y.defaultType,o(r),y._getInstance(r,t)},y._getInstance=function(e,n){var r=g[e];if(r)return n(null,r);var t=p+("auto"==e?"No supported storages":'No "'+e+'" storage support');if(null===r)return n(new Error(t));var o=i(e);if(!o||!o.instance)return n(new Error(t));r=g[e]=o.instance,r.init(n)},d.forEach(function(e){y[e]=function(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);y.getStorage(function(t,o){if(t){return(r.filter(function(e){return"function"==typeof e})[0]||n)(t)}o[e].apply(o,r)})}});var h=y.StorageDB=function(e){function n(e){return r.transaction([y.storeName],e).objectStore(y.storeName)}var r,t=this;t.init=function(n){var o=u(n);f(e,function(e,n){if(e)return o(e);r=n,o(null,t)})},t.close=function(){r&&r.close(),delete g.db,delete g.auto},t.setItem=function(e,r,t){var o=u(t);s(n("readwrite").put({key:e,value:String(r)}),l(o))},t.getItem=function(e,r){var t=u(r);s(n("readonly").get(e),function(e,n){if(e)return t(e);var r=n.target.result;t(null,r?r.value:null)})},t.hasItem=function(e,r){var t=u(r);s(n("readonly").get(e),function(e,n){if(e)return t(e);t(null,Boolean(n.target.result))})},t.removeItem=function(e,r){var t=u(r);s(n("readwrite").delete(e),l(function(e,n){setTimeout(t.bind(null,e,n),0)}))},t.getKeys=function(e){var r=u(e),t=[];s(n("readonly").openCursor(),function(e,n){if(e)return r(e);var o=n.target.result;if(o)return t.push(o.key),o.continue();r(null,t)})},t.getLength=function(e){var r=u(e);s(n("readonly").count(),l(r))},t.clear=function(e){var r=u(e);s(n("readwrite").clear(),l(r))}};h.create=function(){var n=e.indexedDB;return n&&n.open&&e.IDBKeyRange?new h(n):null},h.setupSchema=function(e){e.objectStoreNames.contains(y.storeName)||e.createObjectStore(y.storeName,{keyPath:"key"})}}(self);
//# sourceMappingURL=kv-keeper.db.map