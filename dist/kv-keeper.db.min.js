// KV-Keeper.js by andre487, see https://clck.ru/9cB92
!function(e){"use strict";function n(){}function r(){E.dbVersion=1,E.dbName="kv-keeper-items",E.storeName="items",E.defaultType=m,E.namespace=t()}function t(){return E.dbName+":"+E.storeName+":"}function o(e){if([g,p,m].indexOf(e)==-1)throw new Error(b+"Invalid type "+e)}function u(e){var r=e||n;return function(e,n){if(e)for(var t=0;t<k.length;t++)k[t](e);return r(e,n)}}function i(e){switch(e){case m:return a();case p:return c(p,S.create());case g:return c(g,LS.create())}return null}function c(e,n){return{type:e,instance:n}}function a(){var e=w.db;return e?c(p,e):(e="undefined"!=typeof S&&S.create())?c(p,e):(e=w.ls,e?c(g,e):"undefined"!=typeof LS?c(g,LS.create()):void 0)}function f(e,n){var r=u(n),t=e.open(E.dbName,E.dbVersion);t.onsuccess=function(){var e=t.result;e.onversionchange=function(){e.close()},r(null,e)},t.onerror=function(e){var n=new Error(b+"DB open request error");n.event=e,r(n)},t.onupgradeneeded=function(){S.setupSchema(t.result)},t.onblocked=function(e){var n=new Error(b+"DB is blocked");n.event=e,r(n)}}function s(e,n){e.onsuccess=function(e){n(null,e)},e.onerror=function(r){var t=e.error.message||"Unknown error ",o=new Error(b+"DB request error: "+t);o.event=r,n(o)}}function l(e){return function(n,r){n?e(n):e(null,r.target.result)}}var d=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"],v=["dbName","storeName","defaultType"],p="db",g="ls",m="auto",y="readwrite",h="readonly",b="[kv-keeper] ",w=(Object.keys,{}),k=[],E={},N=!0;"object"==typeof exports&&(exports=E,N=!1),e.modules&&modules.define&&modules.require&&(modules.define("kv-keeper",function(e){e(E)}),N=!1),N&&(e.KvKeeper=E),r(),E.preconnect=function(){E.getStorage(n)},E.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");k.push(e)},E.removeErrorListener=function(e){var n=k.indexOf(e);n>-1&&k.splice(n,1)},E.getErrorListeners=function(){return k},E.removeAllErrorListeners=function(){k=[]},E.configure=function(e){if(E.__configured)throw new Error(b+"Configuration can be set only once");E.__configured=!0,"defaultType"in e&&o(e.defaultType);for(var n in e)if(e.hasOwnProperty(n)){if(!(v.indexOf(n)>-1))throw r(),new Error(b+n+" is not configurable");E[n]=e[n]}E.namespace=t()},E.getStorage=function(e,n){var r=e,t=n;"function"==typeof r&&(t=e,r=null),t=u(t),r=r||E.defaultType,o(r),E._getInstance(r,t)},E._getInstance=function(e,n){var r=w[e];if(r)return n(null,r);var t=b+(e==m?"No supported storages":'No "'+e+'" storage support');if(null===r)return n(new Error(t));var o=i(e);return o&&o.instance?(r=w[e]=o.instance,void r.init(n)):n(new Error(t))},d.forEach(function(e){E[e]=function(){for(var r=[],t=0;t<arguments.length;t++)r.push(arguments[t]);E.getStorage(function(t,o){if(t){var u=r.filter(function(e){return"function"==typeof e})[0]||n;return u(t)}o[e].apply(o,r)})}});var S=E.StorageDB=function(e){function n(e){return r.transaction([E.storeName],e).objectStore(E.storeName)}var r,t=this;t.init=function(n){var o=u(n);f(e,function(e,n){return e?o(e):(r=n,void o(null,t))})},t.close=function(){r&&r.close(),delete w.db,delete w.auto},t.setItem=function(e,r,t){var o=u(t);s(n(y).put({key:e,value:String(r)}),l(o))},t.getItem=function(e,r){var t=u(r);s(n(h).get(e),function(e,n){if(e)return t(e);var r=n.target.result;t(null,r?r.value:null)})},t.hasItem=function(e,r){var t=u(r);s(n(h).get(e),function(e,n){return e?t(e):void t(null,Boolean(n.target.result))})},t.removeItem=function(e,r){var t=u(r);s(n(y).delete(e),l(function(e,n){setTimeout(t.bind(null,e,n),0)}))},t.getKeys=function(e){var r=u(e),t=[];s(n(h).openCursor(),function(e,n){if(e)return r(e);var o=n.target.result;return o?(t.push(o.key),o.continue()):void r(null,t)})},t.getLength=function(e){var r=u(e);s(n(h).count(),l(r))},t.clear=function(e){var r=u(e);s(n(y).clear(),l(r))}};S.create=function(){var n=e.indexedDB;return n&&n.open&&e.IDBKeyRange?new S(n):null},S.setupSchema=function(e){e.objectStoreNames.contains(E.storeName)||e.createObjectStore(E.storeName,{keyPath:"key"})}}(self);
//# sourceMappingURL=kv-keeper.db.map