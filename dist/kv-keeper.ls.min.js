!function(e){"use strict";function t(){}function n(){m.dbVersion=1,m.dbName="kv-keeper-items",m.storeName="items",m.defaultType="auto",m.namespace=r()}function r(){return m.dbName+":"+m.storeName+":"}function o(e){if(["ls","db","auto"].indexOf(e)==-1)throw new Error("[kv-keeper] Invalid type "+e)}function u(e){var n=e||t;return function(e,t){if(e)for(var r=0;r<d.length;r++)d[r](e);return n(e,t)}}function i(e){switch(e){case"auto":return c();case"db":return a("db",DB.create());case"ls":return a("ls",g.create())}return null}function a(e,t){return{type:e,instance:t}}function c(){var e=p.db;return e?a("db",e):(e="undefined"!=typeof DB&&DB.create())?a("db",e):(e=p.ls,e?a("ls",e):void 0!==g?a("ls",g.create()):void 0)}var f=["setItem","getItem","hasItem","removeItem","getKeys","getLength","clear"],l=["dbName","storeName","defaultType"],s=Object.keys,p={},d=[],m={},v=!0;"object"==typeof exports&&(exports=m,v=!1),e.modules&&modules.define&&modules.require&&(modules.define("kv-keeper",function(e){e(m)}),v=!1),v&&(e.KvKeeper=m),n(),m.preconnect=function(){m.getStorage(t)},m.addErrorListener=function(e){if("function"!=typeof e)throw new Error("Listener must be a function");d.push(e)},m.removeErrorListener=function(e){var t=d.indexOf(e);t>-1&&d.splice(t,1)},m.getErrorListeners=function(){return d},m.removeAllErrorListeners=function(){d=[]},m.configure=function(e){if(m.__configured)throw new Error("[kv-keeper] Configuration can be set only once");m.__configured=!0,"defaultType"in e&&o(e.defaultType);for(var t in e)if(e.hasOwnProperty(t)){if(!(l.indexOf(t)>-1))throw n(),new Error("[kv-keeper] "+t+" is not configurable");m[t]=e[t]}m.namespace=r()},m.getStorage=function(e,t){var n=e,r=t;"function"==typeof n&&(r=e,n=null),r=u(r),n=n||m.defaultType,o(n),m._getInstance(n,r)},m._getInstance=function(e,t){var n=p[e];if(n)return t(null,n);var r="[kv-keeper] "+("auto"==e?"No supported storages":'No "'+e+'" storage support');if(null===n)return t(new Error(r));var o=i(e);if(!o||!o.instance)return t(new Error(r));n=p[e]=o.instance,n.init(t)},f.forEach(function(e){m[e]=function(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);m.getStorage(function(r,o){if(r){return(n.filter(function(e){return"function"==typeof e})[0]||t)(r)}o[e].apply(o,n)})}});var g=m.StorageLS=function(e){var n=this;n.init=function(e){e(null,n)},n.setItem=function(t,n,r){var o=u(r);try{e.setItem(g.createKey(t),n),o(null)}catch(e){o(e)}},n.getItem=function(t,n){n(null,e.getItem(g.createKey(t)))},n.hasItem=function(t,n){n(null,null!==e.getItem(g.createKey(t)))},n.removeItem=function(n,r){var o=r||t;e.removeItem(g.createKey(n)),o(null)},n.getKeys=function(t){for(var n=s(e),r=m.namespace.length,o=[],u=0;u<n.length;u++){var i=n[u];y(i)&&o.push(i.slice(r))}t(null,o)},n.getLength=function(t){t(null,s(e).filter(y).length)},n.clear=function(t){s(e).filter(y).forEach(e.removeItem,e),t(null)},n.close=function(){delete p.ls,delete p.auto}};g.createKey=function(e){return m.namespace+e};var y=g.isKeeperKey=function(e){return 0==e.indexOf(m.namespace)};g.create=function(){var t;try{t=e.localStorage}catch(e){}return t?new g(t):null}}(self);
//# sourceMappingURL=kv-keeper.ls.map